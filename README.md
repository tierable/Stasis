# Stasis

Stasis is a general purpose library to persist state. Stasis uses an annotation processing and code generation mechanism to create classes that help preserve the state of its intended target.


## The (Android) problem
Android user interface classes (`Activity`s, `Fragment`s, etc) provide a (limited) mechanism to save important bits of the UI state (the `onSavedInstanceState(Bundle)` and `onRestoreInstanceState(Bundle)` mechanism).
However, in practice this is not comprehensive enough to fully restore the UI.
There's not commonly known flags (like `freezesText` for `TextView`s) or certain bits of state that cannot be properly saved using a `Bundle`.

Stasis provides a general purpose mechanism to persist state.
The library provides an Android library that can be plugged into projects with ease.


## Usage
Stasis uses a similar approach to [Jake Wharton's ButterKnife](https://github.com/JakeWharton/butterknife) library. 
Just annotate the relevant fields with the `@StasisPreserve` annotation and the code generation creates a class for you.


### Providing a mapping class
Provide a *single* interface (for now?) in your project and mark it with the `StasisPreservationMapping` annotation.

The mapping interface can extend other interfaces.

Methods:

* Can be named whatever you desire (as long as it makes sense)
* Must return a `StatisPreservationStrategy`
* Can have multiple parameters

```Java
// Uses the marker annotation
@StasisPreservationMapping(MyFallbackPreservationStrategy.class)
public interface DemoMapping 
	extends AnotherMapping, YetAnotherMapping {
	// Multiple mappings for a StasisPreservationStrategy
	StasisPreservationStrategyButton getMapping(Button button, ButtonChildClass buttonChildClass);

	// Single mapping for a StasisPreservationStrategy
	StasisPreservationStrategyTextField getMapping(TextField textField);

	// etc
}
```


### Preserving state

```Java

public class DemoClass {

	@StasisPreserve
	Button buttonWithADefaultPreservationStrategy;

	@StasisPreserve(value = MyCustomButtonPreservationStrategy.class)
	Button buttonWithACustomPreservationStrategy;

	@StasisPreserve(enabled = false)
	Button buttonWithPreservationDisabled;

	Button buttonNotPreserved;

	// Generated by Stasis
	private StasisPreservationStrategyDemoClass preservationStrategy;
	
	
	public void initialise() {
		preservationStrategy = new StasisPreservationStrategyDemoClass();
	}
	
	public void saveState() {
		// 'Freeze'/'save' this classes state
		preservationStrategy.freeze(this);
		
		// TODO: save the preservationStrategy somewhere
	}
	
	public void restoreState() {
		// Restore the preservationStrategy from somewhere
		
		// 'UnFreeze'/'restore' this classes state
		preservationStrategy.unFreeze(this);
	}
	
	// etc
}
```
